<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How we rebuilt client-side search, delivering a better user experience while making it faster and smaller at the same time
"><link rel=canonical href=https://pei-yan-2147.github.io/blog/2021/09/13/search-better-faster-smaller.html><link rel=next href=../26/excluding-content-from-search.html><link rel=icon href=../../../../logo/logo.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.32"><title>Search: better, faster, smaller - PEI</title><link rel=stylesheet href=../../../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><script src=https://unpkg.com/iframe-worker/shim></script><script src=../../../../assets/pymdownx-extras/material-extra-theme-2ek1P7jT.js type=text/javascript></script><script src=../../../../assets/pymdownx-extras/material-extra-3rdparty-BUCF4rjN.js type=text/javascript></script><!-- 
<script type="text/javascript">
  window.MathJax = {
      tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],  // 支持 $...$ 和 \(...\) 语法
          displayMath: [['$$', '$$'], ['\\[', '\\]']],
      },
      options: {
          processEscapes: true
      }
  };
</script> --><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><!-- 背景图片 --><div class=image-background></div><!-- 星空和流星效果的Canvas背景 --><canvas id=starCanvas style="z-index: -2; position: fixed; top: 0; left: 0; width: 100%; height: 100%;"></canvas><!-- 粒子效果的Canvas背景，放置在星空和流星前面 --><canvas id=particleCanvas style="z-index: -1; position: fixed; top: 0; left: 0; width: 100%; height: 100%;"></canvas><script>
document.addEventListener("DOMContentLoaded", function() {
  var tocContainer = document.querySelector('.custom-toc-container');
  var contentInner = document.querySelector('.md-content__inner');

  // 设置星空流星的 Canvas 尺寸
  var starCanvas = document.getElementById('starCanvas');
  var starCtx = starCanvas.getContext('2d');
  function resizeStarCanvas() {
    starCanvas.width = window.innerWidth;
    starCanvas.height = window.innerHeight;
  }
  resizeStarCanvas();
  window.addEventListener('resize', resizeStarCanvas);

  // 设置粒子效果的 Canvas 尺寸
  var particleCanvas = document.getElementById('particleCanvas');
  var particleCtx = particleCanvas.getContext('2d');
  function resizeParticleCanvas() {
    particleCanvas.width = window.innerWidth;
    particleCanvas.height = window.innerHeight;
  }
  resizeParticleCanvas();
  window.addEventListener('resize', resizeParticleCanvas);

  // 星星类
  class Star {
    constructor() {
      this.reset();  // 随机初始化星星的位置、大小和透明度
    }

    reset() {
      this.x = Math.random() * starCanvas.width;
      this.y = Math.random() * starCanvas.height;
      this.originalSize = Math.random() * 2 + 1;
      this.size = 0;
      this.alpha = 0;
      this.growthSpeed = 0.02;
      this.shrinkSpeed = 0.01;
      this.life = Math.random() * 200 + 100;
    }

    update() {
      if (this.life > 100) {
        this.size += this.growthSpeed;
        this.alpha += this.growthSpeed;
        if (this.size > this.originalSize) this.size = this.originalSize;
        if (this.alpha > 1) this.alpha = 1;
      } else {
        this.size -= this.shrinkSpeed;
        this.alpha -= this.shrinkSpeed;
        if (this.size < 0) this.size = 0;
        if (this.alpha < 0) this.alpha = 0;
      }

      this.life -= 1;
      if (this.life <= 0) this.reset();
    }

    draw() {
      starCtx.fillStyle = `rgba(242, 187, 255, ${this.alpha})`;
      starCtx.beginPath();
      starCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      starCtx.closePath();
      starCtx.fill();
    }
  }

  // 流星类
  class Meteor {
    constructor(x = null, y = null) {
      this.isCustom = (x !== null && y !== null); // 判斷是否是滑鼠生成的流星
      this.reset(x, y);
    }

    reset(x = null, y = null) {
      if (this.isCustom) {
        this.x = x;
        this.y = y;
        this.size = this.originalSize; // 立即设为最大值
        this.alpha = 1; // 立即设为最大透明度
      } else {
        this.x = Math.random() * starCanvas.width / 2;
        this.y = Math.random() * starCanvas.height;
        this.size = 0;
        this.alpha = 0;
      }
      this.originalSize = Math.random() * 1 + 1;
      this.growthSpeed = 0.03;
      this.speedX = Math.random() * 8 + 4;
      this.speedY = Math.random() * 4 + 2;
    }

    update() {
      this.x += this.speedX;
      this.y += this.speedY;

      if (!this.isCustom) { // 非滑鼠生成的流星才有增大過程
        this.size += this.growthSpeed;
        this.alpha += this.growthSpeed;
        if (this.size > this.originalSize) this.size = this.originalSize;
        if (this.alpha > 1) this.alpha = 1;
        this.alpha -= 0.025;
      } else {
        // 滑鼠生成的流星更快消失
        this.alpha -= 0.025; // 透明度更快減少
      }

      // 如果是滑鼠生成的流星且透明度為0，將其從數組中移除
      if (this.isCustom && this.alpha <= 0) {
        return true; // 返回true表示可以從數組中移除
      }

      if (!this.isCustom && this.isOutOfView()) {
        this.reset(); // 非滑鼠生成的流星需要重新生成
      }
      return false; // 不移除流星
    }

    draw() {
      starCtx.strokeStyle = `rgba(242, 187, 255, ${this.alpha})`;
      starCtx.lineWidth = this.size;
      starCtx.beginPath();
      starCtx.moveTo(this.x, this.y);
      starCtx.lineTo(this.x - this.speedX * 5, this.y - this.speedY * 5);
      starCtx.stroke();

      starCtx.fillStyle = `rgba(242, 187, 255, ${this.alpha})`;
      this.drawStarShape(this.x, this.y, this.size, 5);
    }

    drawStarShape(cx, cy, outerRadius, spikes) {
      let rot = Math.PI / 2 * 3;
      let step = Math.PI / spikes;

      starCtx.beginPath();
      starCtx.moveTo(cx, cy - outerRadius);
      for (let i = 0; i < spikes; i++) {
        let x = cx + Math.cos(rot) * outerRadius;
        let y = cy + Math.sin(rot) * outerRadius;
        starCtx.lineTo(x, y);
        rot += step;
      }
      starCtx.lineTo(cx, cy - outerRadius);
      starCtx.closePath();
      starCtx.fill();
    }

    isOutOfView() {
      return this.x > starCanvas.width || this.y > starCanvas.height || this.alpha <= 0;
    }
  }

  // 粒子类
  class Particle {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.size = Math.random() * 3 + 1;
      this.speedX = Math.random() * 3 - 1.5;
      this.speedY = Math.random() * 3 - 1.5;
      this.alpha = 1;
    }

    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      if (this.size > 0.2) this.size -= 0.1;
      this.alpha -= 0.02;  // 粒子逐渐消失
    }

    draw() {
      particleCtx.fillStyle = `rgba(242, 187, 255, ${this.alpha})`;
      particleCtx.beginPath();
      particleCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      particleCtx.closePath();
      particleCtx.fill();
    }
  }

  // 初始化粒子、星星、流星数组
  let starsArray = [];
  let meteorsArray = [];
  let customMeteorsArray = [];
  let particlesArray = [];
  const maxMeteors = 1;

  // 初始化星星
  function initStars() {
    starsArray = [];
    for (let i = 0; i < 150; i++) {
      starsArray.push(new Star());
    }
  }

  // 生成更多流星
  function createMeteor() {
    if (meteorsArray.length < maxMeteors) {
      meteorsArray.push(new Meteor());
    }
  }

  // 生成粒子
  function createParticle(event) {
    const x = event.x;
    const y = event.y;
    for (let i = 0; i < 1; i++) {
      particlesArray.push(new Particle(x, y));
    }
  }

  // 生成滑鼠流星
  function createCustomMeteor(event) {
    const x = event.clientX;
    const y = event.clientY;
    const newMeteor = new Meteor(x, y);
    newMeteor.speedX = Math.random() * 8 + 4;  // 設置滑鼠流星的速度
    newMeteor.speedY = Math.random() * 4 + 2;
    newMeteor.size = newMeteor.originalSize; // 立即設定最大大小
    newMeteor.alpha = 1; // 立即設定最大透明度
    customMeteorsArray.push(newMeteor);
  }

  // 更新并绘制星星、流星和粒子
  function handleParticles() {
    for (let i = 0; i < particlesArray.length; i++) {
      particlesArray[i].update();
      particlesArray[i].draw();
      if (particlesArray[i].alpha <= 0) {
        particlesArray.splice(i, 1);
        i--;
      }
    }
  }

  function handleStarsAndMeteors() {
    for (let i = 0; i < starsArray.length; i++) {
      starsArray[i].update();
      starsArray[i].draw();
    }

    for (let i = 0; i < meteorsArray.length; i++) {
      meteorsArray[i].update();
      meteorsArray[i].draw();
      if (meteorsArray[i].isOutOfView()) {
        meteorsArray.splice(i, 1);
        i--;
      }
    }

    for (let i = 0; i < customMeteorsArray.length; i++) {
      if (customMeteorsArray[i].update()) {
        customMeteorsArray.splice(i, 1); // 移除透明度為0的滑鼠生成流星
        i--;
      } else {
        customMeteorsArray[i].draw();
      }
    }
  }

  // 动画循环
  function animate() {
    starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
    particleCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
    handleStarsAndMeteors();
    handleParticles();
    requestAnimationFrame(animate);
  }

  // 初始化并开始动画
  initStars();
  animate();

  // 流星的生成频率增加
  setInterval(createMeteor, 500);

  // 监听鼠标事件生成粒子
  window.addEventListener('mousemove', createParticle);

  // // 监听鼠标点击生成额外流星
  // window.addEventListener('click', createCustomMeteor);


  // 处理图像大小调整的逻辑
  document.querySelectorAll('img').forEach(function(img) {
      const match = img.src.match(/=(\d+)%x$/);
      if (match) {
          const widthPercentage = match[1];
          img.style.width = widthPercentage + '%';
          img.style.height = 'auto';
          img.src = img.src.replace(/=(\d+)%x$/, '');
      }
  });
});
</script><!-- Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-RCGHEYTD16"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-RCGHEYTD16');
</script><!-- 

 --><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../../assets/pymdownx-extras/extra-8611f6c398.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=dracula data-md-color-primary=deep-purple data-md-color-accent=deep-purple> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#search-better-faster-smaller class=md-skip> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button class="md-banner__button md-icon" aria-label="Don't show this again"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> <!-- <a href="https://github.com/pei-yan-2147">Sponsorship</a>

is now available!
<span class="twemoji heart-throb">
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.655 14.916v-.001h-.002l-.006-.003-.018-.01a22.066 22.066 0 0 1-3.744-2.584C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.044 5.231-3.886 6.818a22.094 22.094 0 0 1-3.433 2.414 7.152 7.152 0 0 1-.31.17l-.018.01-.008.004a.75.75 0 0 1-.69 0Z"/></svg>
</span> --> <!-- ---------------------------------------------------------------------------------- --> <!-- 近期更新<a href="機器學習%28Machine%20Learning%29.html">人工智慧</a> --> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <a href=https://pei-yan-2147.github.io/ title=PEI class="md-header__button md-logo" aria-label=PEI> <img src=../../../../logo/logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> PEI </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Search: better, faster, smaller </span> </div> </div> </div> <div class=md-header__options> <div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon"> <a href=javascript:toggleScheme(); title="Light mode" class=light-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg> </a> <a href=javascript:toggleScheme(); title="Dark mode" class=dark-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg> </a> <a href=javascript:toggleScheme(); title="System preference" class=system-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34Z"/></svg> </a> <a href=javascript:toggleScheme(); title="Unknown scheme" class=unknown-mode> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10Z"/></svg> </a> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../index.html class=md-tabs__link> 首頁 </a> </li> <li class=md-tabs__item> <a href=../../../../%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85.html class=md-tabs__link> 演算法筆記 </a> </li> <li class=md-tabs__item> <a href=../../../../mack%E5%BE%AE%E7%A9%8D%E5%88%86.html class=md-tabs__link> mack微積分 </a> </li> <li class=md-tabs__item> <a href=../../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7%E5%89%8D%E8%A8%80.html class=md-tabs__link> 人工智慧 </a> </li> <li class=md-tabs__item> <a href=../../../../%E5%9F%BA%E7%A4%8E%E5%BE%AE%E7%A9%8D%E5%88%86.html class=md-tabs__link> 基礎微積分 </a> </li> <li class=md-tabs__item> <a href=../../../../%E6%BB%BE%E7%90%83%E5%88%86%E9%9A%8A.html class=md-tabs__link> 滾球分隊 </a> </li> <li class=md-tabs__item> <a href=../../../../mkdocs%E7%AD%86%E8%A8%98.html class=md-tabs__link> mkdocs筆記 </a> </li> <li class=md-tabs__item> <a href=../../../../LaTeX.html class=md-tabs__link> LaTeX </a> </li> <li class=md-tabs__item> <a href=../../../../%E6%B8%AC%E8%A9%A6.html class=md-tabs__link> 測試 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../index.html class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../index.html title=PEI class="md-nav__button md-logo" aria-label=PEI data-md-component=logo> <img src=../../../../logo/logo.png alt=logo> </a> PEI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../index.html class=md-nav__link> <span class=md-ellipsis> 首頁 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> 演算法筆記 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 演算法筆記 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> <span class=md-ellipsis> 競賽準備 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 競賽準備 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../%E5%BE%85%E8%BE%A6%E4%BA%8B%E9%A0%85.html class=md-nav__link> <span class=md-ellipsis> 待辦事項 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%B5%95%E5%B0%8D%E8%A6%81%E8%A8%98%E5%BE%97.html class=md-nav__link> <span class=md-ellipsis> 絕對要記得 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%80%83%E5%89%8D%E5%BF%85%E7%9C%8B.html class=md-nav__link> <span class=md-ellipsis> 考前必看 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%9C%89%E4%BA%8B%E6%B2%92%E4%BA%8B%E6%89%93%E4%B8%80%E6%AC%A1.html class=md-nav__link> <span class=md-ellipsis> 有事沒事打一次 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> 概念、語法、技巧 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 概念、語法、技巧 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../%E8%A4%87%E9%9B%9C%E5%BA%A6.html class=md-nav__link> <span class=md-ellipsis> 複雜度 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%B6%93%E5%85%B8%E5%A0%B1%E9%8C%AF.html class=md-nav__link> <span class=md-ellipsis> 經典報錯 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%81%B7%E6%87%B6%E6%96%B9%E6%B3%95.html class=md-nav__link> <span class=md-ellipsis> 偷懶方法 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%87%B6%E4%BA%BA%E8%BC%B8%E5%85%A5%E6%B3%95%EF%BC%8C%E6%AF%94%E8%B3%BD%E6%99%82%E7%94%A8.html class=md-nav__link> <span class=md-ellipsis> 懶人輸入法，比賽時用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%B8%B8%E7%94%A8%E5%85%A7%E5%BB%BA%E5%87%BD%E6%95%B8.html class=md-nav__link> <span class=md-ellipsis> 常用內建函數 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%8C%87%E6%A8%99.html class=md-nav__link> <span class=md-ellipsis> 指標(*、&) </span> </a> </li> <li class=md-nav__item> <a href=../../../../getline%E6%90%AD%E9%85%8Dstringstream.html class=md-nav__link> <span class=md-ellipsis> getline搭配stringstream </span> </a> </li> <li class=md-nav__item> <a href=../../../../scanf%20%26%20printf.html class=md-nav__link> <span class=md-ellipsis> scanf & printf </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E4%BD%8D%E5%85%83%E9%81%8B%E7%AE%97.html class=md-nav__link> <span class=md-ellipsis> 位元運算 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E4%BD%BF%E7%94%A8%E4%BD%8D%E5%85%83%E7%AA%AE%E8%88%89.html class=md-nav__link> <span class=md-ellipsis> 使用位元窮舉 </span> </a> </li> <li class=md-nav__item> <a href=../../../../bitset%E4%BD%BF%E7%94%A8.html class=md-nav__link> <span class=md-ellipsis> bitset使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%8E%92%E5%BA%8Fsort.html class=md-nav__link> <span class=md-ellipsis> 排序sort </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AE%9A%E7%BE%A9%E6%AF%94%E8%BC%83%E8%A6%8F%E5%89%87.html class=md-nav__link> <span class=md-ellipsis> 定義比較規則 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%8E%92%E5%88%97%E7%94%9F%E6%88%90permutation%E7%AA%AE%E8%88%89.html class=md-nav__link> <span class=md-ellipsis> 排列生成permutation窮舉 </span> </a> </li> <li class=md-nav__item> <a href=../../../../switch%E4%B9%8B%E4%BD%BF%E7%94%A8.html class=md-nav__link> <span class=md-ellipsis> switch之使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../do%20while%E4%BD%BF%E7%94%A8.html class=md-nav__link> <span class=md-ellipsis> do while使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%88%A4%E6%96%B7%E6%98%AF%E5%90%A6%E7%82%BA%E6%95%B8%E5%AD%97%E3%80%81%E5%AD%97%E6%AF%8D.html class=md-nav__link> <span class=md-ellipsis> 判斷是否為數字、字母 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%A4%A7%E5%B0%8F%E5%AF%AB%E8%BD%89%E6%8F%9B.html class=md-nav__link> <span class=md-ellipsis> 大小寫轉換 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%B0%8F%E6%95%B8%E9%BB%9E%E5%BE%8C%E5%B9%BE%E4%BD%8D.html class=md-nav__link> <span class=md-ellipsis> 小數點後幾位 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%BC%B8%E5%87%BA%E7%B5%90%E5%B0%BE%E7%A9%BA%E7%99%BD.html class=md-nav__link> <span class=md-ellipsis> 輸出結尾空白 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%89%8D%E5%BA%8F%E3%80%81%E4%B8%AD%E5%BA%8F%E3%80%81%E5%BE%8C%E5%BA%8F.html class=md-nav__link> <span class=md-ellipsis> 前序、中序、後序 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> 數論 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> 數論 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../log.html class=md-nav__link> <span class=md-ellipsis> log </span> </a> </li> <li class=md-nav__item> <a href=../../../../%CE%A3%20sigma%20%28%E8%A5%BF%E6%A0%BC%E7%91%AA%29.html class=md-nav__link> <span class=md-ellipsis> Σ sigma (西格瑪) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%A8%A1%E9%81%8B%E7%AE%97.html class=md-nav__link> <span class=md-ellipsis> %模運算 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%B2%BB%E9%A6%AC%E5%B0%8F%E5%AE%9A%E7%90%86.html class=md-nav__link> <span class=md-ellipsis> 元素/費馬小定理 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%9C%88%E7%B5%90%E6%A7%8B%26%E7%B4%84%E7%91%9F%E5%A4%AB%E5%95%8F%E9%A1%8C.html class=md-nav__link> <span class=md-ellipsis> 圈結構&約瑟夫問題 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E4%B8%83%E6%A9%8B%E5%95%8F%E9%A1%8C%26%E4%B8%80%E7%AD%86%E7%95%AB%E5%95%8F%E9%A1%8C.html class=md-nav__link> <span class=md-ellipsis> 七橋問題&一筆畫問題 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%B3%AA%E6%95%B8%E3%80%81%E6%89%BE%E8%B3%AA%E5%9B%A0%E6%95%B8%28%E5%9F%83%E6%B0%8F%E7%AF%A9%29.html class=md-nav__link> <span class=md-ellipsis> 質數、找質因數(埃氏篩) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%9B%A0%E6%95%B8%E5%80%8D%E6%95%B8.html class=md-nav__link> <span class=md-ellipsis> 因數倍數 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%AD%90%E5%B9%BE%E9%87%8C%E5%BE%97%E5%BC%95%E7%90%86.html class=md-nav__link> <span class=md-ellipsis> 歐幾里得引理 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%AD%90%E5%B9%BE%E9%87%8C%E5%BE%97%E6%BC%94%E7%AE%97%E6%B3%95%EF%BC%9B%E8%BC%BE%E8%BD%89%E7%9B%B8%E9%99%A4%E6%B3%95%EF%BC%9B%E6%9C%80%E5%A4%A7%E5%85%AC%E5%9B%A0%E6%95%B8gcd.html class=md-nav__link> <span class=md-ellipsis> 歐幾里得演算法；輾轉相除法；最大公因數gcd </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%93%B4%E5%B1%95%E6%AD%90%E5%B9%BE%E9%87%8C%E5%BE%97%E6%BC%94%E7%AE%97%E6%B3%95.html class=md-nav__link> <span class=md-ellipsis> 擴展歐幾里得演算法 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%AD%90%E6%8B%89%E5%87%BD%E6%95%B8.html class=md-nav__link> <span class=md-ellipsis> 歐拉函數 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%9F%A9%E9%99%A3%E9%81%8B%E7%AE%97.html class=md-nav__link> <span class=md-ellipsis> 矩陣運算 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%8D%A1%E5%A1%94%E8%98%AD%E6%95%B8.html class=md-nav__link> <span class=md-ellipsis> 卡塔蘭數(Catalan Numbers) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%A4%A7%E6%95%B8%E9%81%8B%E7%AE%97.html class=md-nav__link> <span class=md-ellipsis> 大數運算 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_4> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> 資料結構 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> 資料結構 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../STL.html class=md-nav__link> <span class=md-ellipsis> STL </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AD%97%E5%85%83%E3%80%81%E5%AD%97%E4%B8%B2.html class=md-nav__link> <span class=md-ellipsis> 字元、字串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E9%8F%88%E7%B5%90%E7%B5%90%E6%A7%8B.html class=md-nav__link> <span class=md-ellipsis> 鏈結結構 </span> </a> </li> <li class=md-nav__item> <a href=../../../../map.html class=md-nav__link> <span class=md-ellipsis> map </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%84%AA%E5%85%88%E6%9F%B1%E5%88%97%28priority_queue%29.html class=md-nav__link> <span class=md-ellipsis> 優先柱列(priority_queue) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%B7%9A%E6%AE%B5%E6%A8%B9.html class=md-nav__link> <span class=md-ellipsis> 線段樹 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AD%97%E5%85%B8%E6%A8%B9%20trie.html class=md-nav__link> <span class=md-ellipsis> 字典樹 trie </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_5> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> 演算法 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> 演算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../%E9%81%9E%E8%BF%B4.html class=md-nav__link> <span class=md-ellipsis> 遞迴 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%88%86%E6%90%9C.html class=md-nav__link> <span class=md-ellipsis> 爆搜 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%89%8D%E7%B6%B4%E5%92%8C%26%E5%B7%AE%E5%88%86.html class=md-nav__link> <span class=md-ellipsis> 前綴和&差分 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%90%9C%E5%B0%8B%E3%80%81%E4%BA%8C%E5%88%86%E6%90%9C%E5%B0%8B%E3%80%81%E8%B7%B3%E8%BA%8D%E4%BA%8C%E5%88%86%E6%90%9C.html class=md-nav__link> <span class=md-ellipsis> 搜尋、二分搜尋、跳躍二分搜 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%93%88%E5%B8%8C%E8%A1%A8.html class=md-nav__link> <span class=md-ellipsis> 哈希表 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E9%9B%A2%E6%95%A3%E5%8C%96.html class=md-nav__link> <span class=md-ellipsis> 離散化 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%BF%AB%E9%80%9F%E5%86%AA.html class=md-nav__link> <span class=md-ellipsis> 快速冪 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%BB%91%E5%8B%95%E8%A6%96%E7%AA%97%28Sliding%20window%29%28%E6%8A%80%E5%B7%A7%29.html class=md-nav__link> <span class=md-ellipsis> 滑動視窗(Sliding window)(技巧) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%8E%83%E7%9E%84%E7%B7%9A%E6%BC%94%E7%AE%97%E6%B3%95.html class=md-nav__link> <span class=md-ellipsis> 掃瞄線演算法 </span> </a> </li> <li class=md-nav__item> <a href=/%E7%88%86%E6%90%9C.html#%E4%B8%89%E6%8A%98%E5%8D%8A%E6%9E%9A%E8%88%89 class=md-nav__link> <span class=md-ellipsis> 折半枚舉 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%B2%AA%E5%BF%83%E6%BC%94%E7%AE%97%E6%B3%95%28Greedy%29.html class=md-nav__link> <span class=md-ellipsis> 貪心演算法(Greedy) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%8B%95%E6%85%8B%E8%A6%8F%E5%8A%83%28dp%29.html class=md-nav__link> <span class=md-ellipsis> 動態規劃(dp) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%9C%96%E8%AB%96.html class=md-nav__link> <span class=md-ellipsis> 圖論 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%A8%B9%E8%AB%96.html class=md-nav__link> <span class=md-ellipsis> 樹論 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> 刷題 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_6_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> 刷題 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6_1> <label class=md-nav__link for=__nav_2_6_1 id=__nav_2_6_1_label tabindex=0> <span class=md-ellipsis> CSEC </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6_1> <span class="md-nav__icon md-icon"></span> CSEC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../CSEC.html class=md-nav__link> <span class=md-ellipsis> 首頁 </span> </a> </li> <li class=md-nav__item> <a href=../../../../CSES%20Problem%20Set.html class=md-nav__link> <span class=md-ellipsis> CSES Problem Set </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../%E5%8C%97%E5%B8%82%E5%AD%B8%E7%A7%91%E8%83%BD%E5%8A%9B%E7%AB%B6%E8%B3%BD.html class=md-nav__link> <span class=md-ellipsis> 北市學科能力競賽 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_6_3> <label class=md-nav__link for=__nav_2_6_3 id=__nav_2_6_3_label tabindex=0> <span class=md-ellipsis> APCS歷屆 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_6_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_6_3> <span class="md-nav__icon md-icon"></span> APCS歷屆 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../%E7%B7%A8%E5%B9%B4%E9%A1%8C%E5%BA%AB%28by%20YUI%20HUANG%29.html class=md-nav__link> <span class=md-ellipsis> 編年/題庫(by YUI HUANG) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AF%A6%E4%BD%9C%E4%B8%80.html class=md-nav__link> <span class=md-ellipsis> 實作一 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AF%A6%E4%BD%9C%E4%BA%8C.html class=md-nav__link> <span class=md-ellipsis> 實作二 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AF%A6%E4%BD%9C%E4%B8%89.html class=md-nav__link> <span class=md-ellipsis> 實作三 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AF%A6%E4%BD%9C%E5%9B%9B.html class=md-nav__link> <span class=md-ellipsis> 實作四 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_7> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> 其他 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_7_label aria-expanded=false> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> 其他 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../APCS.html class=md-nav__link> <span class=md-ellipsis> APCS </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E4%BD%BF%E7%94%A8vscode%E6%92%B0%E5%AF%ABc%2B%2B.html class=md-nav__link> <span class=md-ellipsis> 使用vscode撰寫c++ </span> </a> </li> <li class=md-nav__item> <a href=../../../../hackmd%E7%89%B9%E6%AE%8A%E4%BD%BF%E7%94%A8.html class=md-nav__link> <span class=md-ellipsis> hackmd特殊使用 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%84%AA%E8%B3%AA%E7%B6%B2%E7%AB%99.html class=md-nav__link> <span class=md-ellipsis> 優質網站 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%87%9F%E9%9A%8A.html class=md-nav__link> <span class=md-ellipsis> 營隊 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%89%93%E5%AD%97%E9%9F%B3%E6%95%88.html class=md-nav__link> <span class=md-ellipsis> 打字音效 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%A1%8C%E9%9D%A2%E8%B2%93%E5%92%AA.html class=md-nav__link> <span class=md-ellipsis> 桌面貓咪 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E8%B3%87%E6%96%99%E4%BE%86%E6%BA%90.html class=md-nav__link> <span class=md-ellipsis> 資料來源 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%8A%A0%E6%B7%B1%E5%8A%A0%E5%BB%A3.html class=md-nav__link> <span class=md-ellipsis> 加深加廣 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E5%AD%B8%E7%BF%92%E8%B3%87%E6%BA%90.html class=md-nav__link> <span class=md-ellipsis> 學習資源 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../mack%E5%BE%AE%E7%A9%8D%E5%88%86.html class=md-nav__link> <span class=md-ellipsis> mack微積分 </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> 人工智慧 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> 人工智慧 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../%E4%BA%BA%E5%B7%A5%E6%99%BA%E6%85%A7%E5%89%8D%E8%A8%80.html class=md-nav__link> <span class=md-ellipsis> 前言 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%A9%9F%E5%99%A8%E5%AD%B8%E7%BF%92%28Machine%20Learning%29.html class=md-nav__link> <span class=md-ellipsis> 機器學習(Machine Learning) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E7%A5%9E%E7%B6%93%E7%B6%B2%E8%B7%AF%28Neural%20Network%29.html class=md-nav__link> <span class=md-ellipsis> 神經網路(Neural Network) </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%28Deep%20Learning%29.html class=md-nav__link> <span class=md-ellipsis> 深度學習(Deep Learning) </span> </a> </li> <li class=md-nav__item> <a href=../../../../CNN%28Convolutional%20Neural%20Network%29.html class=md-nav__link> <span class=md-ellipsis> CNN(Convolutional Neural Network) </span> </a> </li> <li class=md-nav__item> <a href=../../../../FCN%28Fully%20Convolutional%20Networks%29.html class=md-nav__link> <span class=md-ellipsis> FCN(Fully Convolutional Networks) </span> </a> </li> <li class=md-nav__item> <a href=../../../../RL%28Reinforcement%20Learning%29.html class=md-nav__link> <span class=md-ellipsis> RL(Reinforcement Learning) </span> </a> </li> <li class=md-nav__item> <a href=../../../../GAN%28generative%20adversarial%20networks%29.html class=md-nav__link> <span class=md-ellipsis> GAN(generative adversarial networks) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../%E5%9F%BA%E7%A4%8E%E5%BE%AE%E7%A9%8D%E5%88%86.html class=md-nav__link> <span class=md-ellipsis> 基礎微積分 </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%BB%BE%E7%90%83%E5%88%86%E9%9A%8A.html class=md-nav__link> <span class=md-ellipsis> 滾球分隊 </span> </a> </li> <li class=md-nav__item> <a href=../../../../mkdocs%E7%AD%86%E8%A8%98.html class=md-nav__link> <span class=md-ellipsis> mkdocs筆記 </span> </a> </li> <li class=md-nav__item> <a href=../../../../LaTeX.html class=md-nav__link> <span class=md-ellipsis> LaTeX </span> </a> </li> <li class=md-nav__item> <a href=../../../../%E6%B8%AC%E8%A9%A6.html class=md-nav__link> <span class=md-ellipsis> 測試 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10 checked> <div class="md-nav__link md-nav__container"> <a href=../../../index.html class="md-nav__link "> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link " for=__nav_10 id=__nav_10_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=true> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_2> <label class=md-nav__link for=__nav_10_2 id=__nav_10_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_2_label aria-expanded=false> <label class=md-nav__title for=__nav_10_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../archive/2024.html class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> <li class=md-nav__item> <a href=../../../archive/2023.html class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../../../archive/2022.html class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../../../archive/2021.html class=md-nav__link> <span class=md-ellipsis> 2021 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10_3> <label class=md-nav__link for=__nav_10_3 id=__nav_10_3_label tabindex=0> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_10_3_label aria-expanded=false> <label class=md-nav__title for=__nav_10_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../category/blog.html class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=../../../category/build.html class=md-nav__link> <span class=md-ellipsis> Build </span> </a> </li> <li class=md-nav__item> <a href=../../../category/general.html class=md-nav__link> <span class=md-ellipsis> General </span> </a> </li> <li class=md-nav__item> <a href=../../../category/performance.html class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> <li class=md-nav__item> <a href=../../../category/search.html class=md-nav__link> <span class=md-ellipsis> Search </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#architecture class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> <nav class=md-nav aria-label=Architecture> <ul class=md-nav__list> <li class=md-nav__item> <a href=#search-index class=md-nav__link> <span class=md-ellipsis> Search index </span> </a> </li> <li class=md-nav__item> <a href=#search-worker class=md-nav__link> <span class=md-ellipsis> Search worker </span> </a> </li> <li class=md-nav__item> <a href=#search-previews class=md-nav__link> <span class=md-ellipsis> Search previews </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#whats-new class=md-nav__link> <span class=md-ellipsis> What's new? </span> </a> <nav class=md-nav aria-label="What's new?"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rich-search-previews class=md-nav__link> <span class=md-ellipsis> Rich search previews </span> </a> </li> <li class=md-nav__item> <a href=#tokenizer-lookahead class=md-nav__link> <span class=md-ellipsis> Tokenizer lookahead </span> </a> <nav class=md-nav aria-label="Tokenizer lookahead"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#case-changes class=md-nav__link> <span class=md-ellipsis> Case changes </span> </a> </li> <li class=md-nav__item> <a href=#version-numbers class=md-nav__link> <span class=md-ellipsis> Version numbers </span> </a> </li> <li class=md-nav__item> <a href=#htmlxml-tags class=md-nav__link> <span class=md-ellipsis> HTML/XML tags </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#accurate-highlighting class=md-nav__link> <span class=md-ellipsis> Accurate highlighting </span> </a> </li> <li class=md-nav__item> <a href=#benchmarks class=md-nav__link> <span class=md-ellipsis> Benchmarks </span> </a> </li> <li class=md-nav__item> <a href=#user-interface class=md-nav__link> <span class=md-ellipsis> User interface </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#whats-next class=md-nav__link> <span class=md-ellipsis> What's next? </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../../index.html class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <div class="md-post__authors md-typeset"> <div class="md-profile md-post__profile"> <span class="md-author md-author--long"> <img src=https://avatars.githubusercontent.com/u/932156 alt="Martin Donath"> </span> <span class=md-profile__description> <strong> <a href=https://github.com/squidfunk>Martin Donath</a> </strong> <br> Creator </span> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg> <time datetime="2021-09-13 00:00:00" class=md-ellipsis>September 13, 2021</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg> <span class=md-ellipsis> in <a href=../../../category/search.html>Search</a>, <a href=../../../category/performance.html>Performance</a></span> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg> <span class=md-ellipsis> 15 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <h1 id=search-better-faster-smaller>Search: better, faster, smaller<a class=headerlink href=#search-better-faster-smaller title="Permanent link"></a></h1> <p><strong>This is the story of how we managed to completely rebuild client-side search,<br> delivering a significantly better user experience while making it faster and<br> smaller at the same time.</strong></p> <p>The <a href=../../setup/setting-up-site-search.md>search</a> of Material for MkDocs is by far one of its best and most-loved<br> assets: <a href=../../plugins/search.md#config.lang>multilingual</a>, <a href=../../setup/building-for-offline-usage.md>offline-capable</a>, and most importantly: <em>all<br> client-side</em>. It provides a solution to empower the users of your documentation<br> to find what they're searching for instantly without the headache of managing<br> additional servers. However, even though several iterations have been made,<br> there's still some room for improvement, which is why we rebuilt the search<br> plugin and integration from the ground up. This article shines some light on the<br> internals of the new search, why it's much more powerful than the previous<br> version, and what's about to come.</p> <p><em>The next section discusses the architecture and issues of the current search<br> implementation. If you immediately want to learn what's new, skip to the<br> <a href=#whats-new>section just after that</a>.</em></p> <h2 id=architecture>Architecture<a class=headerlink href=#architecture title="Permanent link"></a></h2> <p>Material for MkDocs uses <a href=https://lunrjs.com>lunr</a> together with <a href=https://github.com/MihaiValentin/lunr-languages>lunr-languages</a> to implement<br> its client-side search capabilities. When a documentation page is loaded and<br> JavaScript is available, the search index as generated by the<br> <a href=../../plugins/search.md>built-in search plugin</a> during the build process is requested from the<br> server:</p> <div class=highlight><pre><span></span><code><span class=kd>const</span><span class=w> </span><span class=nx>index$</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>document</span><span class=p>.</span><span class=nx>forms</span><span class=p>.</span><span class=nx>namedItem</span><span class=p>(</span><span class=s2>&quot;search&quot;</span><span class=p>)</span>
<span class=w>  </span><span class=o>?</span><span class=w> </span><span class=nx>__search</span><span class=o>?</span><span class=p>.</span><span class=nx>index</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=nx>requestJSON</span><span class=o>&lt;</span><span class=nx>SearchIndex</span><span class=o>&gt;</span><span class=p>(</span>
<span class=w>    </span><span class=ow>new</span><span class=w> </span><span class=nx>URL</span><span class=p>(</span><span class=s2>&quot;search/search_index.json&quot;</span><span class=p>,</span><span class=w> </span><span class=nx>config</span><span class=p>.</span><span class=nx>base</span><span class=p>)</span>
<span class=w>  </span><span class=p>)</span>
<span class=w>  </span><span class=o>:</span><span class=w> </span><span class=nx>NEVER</span>
</code></pre></div> <h3 id=search-index>Search index<a class=headerlink href=#search-index title="Permanent link"></a></h3> <p>The search index includes a stripped-down version of all pages. Let's take a<br> look at an example to understand precisely what the search index contains from<br> the original Markdown file:</p> <details class=example> <summary>Expand to inspect example</summary> <div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=search-index-docspagemd name=__tabbed_1 type=radio><input id=search-index-search_indexjson name=__tabbed_1 type=radio><div class=tabbed-labels><label for=search-index-docspagemd><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06ZM3.28 7.78 1.81 9.25l1.47 1.47a.751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042Zm8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914-.013-.011Z"/></svg></span> <code>docs/page.md</code></label><label for=search-index-search_indexjson><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M8.47 4.97a.75.75 0 0 0 0 1.06L9.94 7.5 8.47 8.97a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06l-2-2a.75.75 0 0 0-1.06 0ZM6.53 6.03a.75.75 0 0 0-1.06-1.06l-2 2a.75.75 0 0 0 0 1.06l2 2a.75.75 0 1 0 1.06-1.06L5.06 7.5l1.47-1.47Z"/><path d="M12.246 13.307a7.501 7.501 0 1 1 1.06-1.06l2.474 2.473a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM1.5 7.5a6.002 6.002 0 0 0 3.608 5.504 6.002 6.002 0 0 0 6.486-1.117.748.748 0 0 1 .292-.293A6 6 0 1 0 1.5 7.5Z"/></svg></span> <code>search_index.json</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=gh># Example</span>

<span class=gu>## Text</span>

It&#39;s very easy to make some words <span class=gs>**bold**</span> and other words <span class=ge>*italic*</span>
with Markdown. You can even add [<span class=nt>links</span>](<span class=na>#</span>), or even <span class=sb>`code`</span>:

<span class=sb>```</span>
<span class=sb>if (isAwesome) {</span>
<span class=sb>  return true</span>
<span class=sb>}</span>
<span class=sb>```</span>

<span class=gu>## Lists</span>

Sometimes you want numbered lists:

<span class=k>1.</span> One
<span class=k>2.</span> Two
<span class=k>3.</span> Three

Sometimes you want bullet points:

<span class=k>*</span><span class=w> </span>Start a line with a star
<span class=k>*</span><span class=w> </span>Profit!
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;config&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;indexing&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;full&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;lang&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>      </span><span class=s2>&quot;en&quot;</span>
<span class=w>    </span><span class=p>],</span>
<span class=w>    </span><span class=nt>&quot;min_search_length&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;prebuild_index&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;separator&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;[\\s\\-]+&quot;</span>
<span class=w>  </span><span class=p>},</span>
<span class=w>  </span><span class=nt>&quot;docs&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example Text It&#39;s very easy to make some words bold and other words italic with Markdown. You can even add links , or even code : if (isAwesome) { return true } Lists Sometimes you want numbered lists: One Two Three Sometimes you want bullet points: Start a line with a star Profit!&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;It&#39;s very easy to make some words bold and other words italic with Markdown. You can even add links , or even code : if (isAwesome) { return true }&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Sometimes you want numbered lists: One Two Three Sometimes you want bullet points: Start a line with a star Profit!&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </div> </div> </div> </details> <p>If we inspect the search index, we immediately see several problems:</p> <ol> <li> <p><strong>All content is included twice</strong>: the search index contains one entry<br> with the entire contents of the page, and one entry for each section of<br> the page, i.e., each block preceded by a headline or subheadline. This<br> significantly contributes to the size of the search index.</p> </li> <li> <p><strong>All structure is lost</strong>: when the search index is built, all structural<br> information like HTML tags and attributes are stripped from the content.<br> While this approach works well for paragraphs and inline formatting, it<br> might be problematic for lists and code blocks. An excerpt:</p> <div class=highlight><pre><span></span><code>… links , or even code : if (isAwesome) { … } Lists Sometimes you want …
</code></pre></div> <ul> <li> <p><strong>Context</strong>: for an untrained eye, the result can look like gibberish, as<br> it's not immediately apparent what classifies as text and what as code.<br> Furthermore, it's not clear that <code>Lists</code> is a headline as it's merged<br> with the code block before and the paragraph after it.</p> </li> <li> <p><strong>Punctuation</strong>: inline elements like links that are immediately followed<br> by punctuation are separated by whitespace (see <code>,</code> and <code>:</code> in the<br> excerpt). This is because all extracted text is joined with a whitespace<br> character during the construction of the search index.</p> </li> </ul> </li> </ol> <p>It's not difficult to see that it can be quite challenging to implement a good<br> search experience for theme authors, which is why Material for MkDocs (up to<br> now) did some <a href=https://github.com/squidfunk/mkdocs-material/blob/ec7ccd2b2d15dd033740f388912f7be7738feec2/src/assets/javascripts/integrations/search/document/index.ts#L68-L71>monkey patching</a> to be able to render slightly more<br> meaningful search previews.</p> <h3 id=search-worker>Search worker<a class=headerlink href=#search-worker title="Permanent link"></a></h3> <p>The actual search functionality is implemented as part of a web worker<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup>,<br> which creates and manages the <a href=https://lunrjs.com>lunr</a> search index. When search is initialized,<br> the following steps are taken:</p> <ol> <li> <p><strong>Linking sections with pages</strong>: The search index is parsed, and each<br> section is linked to its parent page. The parent page itself is <em>not<br> indexed</em>, as it would lead to duplicate results, so only the sections<br> remain. Linking is necessary, as search results are grouped by page.</p> </li> <li> <p><strong>Tokenization</strong>: The <code>title</code> and <code>text</code> values of each section are split<br> into tokens by using the <a href=../../plugins/search.md#config.separator><code>separator</code></a> as configured in<br> <code>mkdocs.yml</code>. Tokenization itself is carried out by<br> <a href=https://github.com/olivernn/lunr.js/blob/aa5a878f62a6bba1e8e5b95714899e17e8150b38/lunr.js#L413-L456>lunr's default tokenizer</a>, which doesn't allow for<br> lookahead or separators spanning multiple characters.</p> <blockquote> <p>Why is this important and a big deal? We will see later how much more we<br> can achieve with a tokenizer that is capable of separating strings with<br> lookahead.</p> </blockquote> </li> <li> <p><strong>Indexing</strong>: As a final step, each section is indexed. When querying the<br> index, if a search query includes one of the tokens as returned by step 2.,<br> the section is considered to be part of the search result and passed to the<br> main thread.</p> </li> </ol> <p>Now, that's basically how the search worker operates. Sure, there's a little<br> more magic involved, e.g., search results are <a href=https://github.com/squidfunk/mkdocs-material/blob/ec7ccd2b2d15dd033740f388912f7be7738feec2/src/assets/javascripts/integrations/search/_/index.ts#L249-L272>post-processed</a> and <a href=https://github.com/squidfunk/mkdocs-material/blob/ec7ccd2b2d15dd033740f388912f7be7738feec2/src/assets/javascripts/integrations/search/_/index.ts#L274-L275>rescored</a> to<br> account for some shortcomings of <a href=https://lunrjs.com>lunr</a>, but in general, this is how data gets<br> into and out of the index.</p> <h3 id=search-previews>Search previews<a class=headerlink href=#search-previews title="Permanent link"></a></h3> <p>Users should be able to quickly scan and evaluate the relevance of a search<br> result in the given context, which is why a concise summary with highlighted<br> occurrences of the search terms found is an essential part of a great search<br> experience.</p> <p>This is where the current search preview generation falls short, as some of the<br> search previews appear not to include any occurrence of any of the search<br> terms. This was due to the fact that search previews were <a href=https://github.com/squidfunk/mkdocs-material/blob/master/src/templates/assets/javascripts/templates/search/index.tsx#L90>truncated after a<br> maximum of 320 characters</a>, as can be seen here:</p> <figure> <p><img alt="search preview" src=../../../search-better-faster-smaller/search-preview.png></p> <figcaption> <p>The first two results look like they're not relevant, as they don't seem to<br> include the query string the user just searched for. Yet, they are.</p> </figcaption> </figure> <p>A better solution to this problem has been on the roadmap for a very, very long<br> time, but in order to solve this once and for all, several factors need to be<br> carefully considered:</p> <ol> <li> <p><strong>Word boundaries</strong>: some themes<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup> for static site generators generate<br> search previews by expanding the text left and right next to an occurrence,<br> stopping at a whitespace character when enough words have been consumed. A<br> preview might look like this:</p> <div class=highlight><pre><span></span><code>… channels, e.g., or which can be configured via mkdocs.yml …
</code></pre></div> <p>While this may work for languages that use whitespace as a separator<br> between words, it breaks down for languages like Japanese or Chinese<sup id=fnref2:3><a class=footnote-ref href=#fn:3>3</a></sup>,<br> as they have non-whitespace word boundaries and use dedicated segmenters to<br> split strings into tokens.</p> </li> <li> <p><strong>Context-awareness</strong>: Although whitespace doesn't work for all languages,<br> one could argue that it could be a good enough solution. Unfortunately, this<br> is not necessarily true for code blocks, as the removal of whitespace might<br> change meaning in some languages.</p> </li> <li> <p><strong>Structure</strong>: Preserving structural information is not a must, but<br> apparently beneficial to build more meaningful search previews which allow<br> for a quick evaluation of relevance. If a word occurrence is part of a code<br> block, it should be rendered as a code block.</p> </li> </ol> <h2 id=whats-new>What's new?<a class=headerlink href=#whats-new title="Permanent link"></a></h2> <p>After we built a solid understanding of the problem space and before we dive<br> into the internals of our new search implementation to see which of the<br> problems it already solves, a quick overview of what features and improvements<br> it brings:</p> <ul> <li><strong>Better</strong>: support for <a href=#rich-search-previews>rich search previews</a>, preserving the structural<br> information of code blocks, inline code, and lists, so they are rendered<br> as-is, as well as <a href=#tokenizer-lookahead>lookahead tokenization</a>, <a href=#accurate-highlighting>more accurate highlighting</a>, and<br> improved stability of typeahead. Also, a <a href=#user-interface>slightly better UX</a>.</li> <li><strong>Faster</strong> and <strong>smaller</strong>: significant decrease in search index size of up<br> to 48% due to improved extraction and construction techniques, resulting in a<br> search experience that is up to 95% faster, which is particularly helpful for<br> large documentation projects.</li> </ul> <h3 id=rich-search-previews>Rich search previews<a class=headerlink href=#rich-search-previews title="Permanent link"></a></h3> <p>As we rebuilt the search plugin from scratch, we reworked the construction of<br> the search index to preserve the structural information of code blocks, inline<br> code, as well as unordered and ordered lists. Using the example from the<br> <a href=#search-index>search index</a> section, here's how it looks:</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=rich-search-previews-now name=__tabbed_2 type=radio><input id=rich-search-previews-before name=__tabbed_2 type=radio><div class=tabbed-labels><label for=rich-search-previews-now>Now</label><label for=rich-search-previews-before>Before</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><img alt="search preview now" src=../../../search-better-faster-smaller/search-preview-now.png></p> </div> <div class=tabbed-block> <p><img alt="search preview before" src=../../../search-better-faster-smaller/search-preview-before.png></p> </div> </div> </div> <p>Now, <strong>code blocks are first-class citizens of search previews</strong>, and even<br> inline code formatting is preserved. Let's take a look at the new structure of<br> the search index to understand why:</p> <details class=example> <summary>Expand to inspect search index</summary> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=rich-search-previews-now_1 name=__tabbed_3 type=radio><input id=rich-search-previews-before_1 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=rich-search-previews-now_1>Now</label><label for=rich-search-previews-before_1>Before</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=err>...</span>
<span class=w>  </span><span class=nt>&quot;docs&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;p&gt;It&#39;s very easy to make some words bold and other words italic with Markdown. You can even add links, or even &lt;code&gt;code&lt;/code&gt;:&lt;/p&gt; &lt;pre&gt;&lt;code&gt;if (isAwesome){\n  return true\n}\n&lt;/code&gt;&lt;/pre&gt;&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;p&gt;Sometimes you want numbered lists:&lt;/p&gt; &lt;ol&gt; &lt;li&gt;One&lt;/li&gt; &lt;li&gt;Two&lt;/li&gt; &lt;li&gt;Three&lt;/li&gt; &lt;/ol&gt; &lt;p&gt;Sometimes you want bullet points:&lt;/p&gt; &lt;ul&gt; &lt;li&gt;Start a line with a star&lt;/li&gt; &lt;li&gt;Profit!&lt;/li&gt; &lt;/ul&gt;&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=err>...</span>
<span class=w>  </span><span class=nt>&quot;docs&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example Text It&#39;s very easy to make some words bold and other words italic with Markdown. You can even add links , or even code : if (isAwesome) { return true } Lists Sometimes you want numbered lists: One Two Three Sometimes you want bullet points: Start a line with a star Profit!&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Example&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Text&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;It&#39;s very easy to make some words bold and other words italic with Markdown. You can even add links , or even code : if (isAwesome) { return true }&quot;</span>
<span class=w>    </span><span class=p>},</span>
<span class=w>    </span><span class=p>{</span>
<span class=w>      </span><span class=nt>&quot;location&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;page/#lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;title&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Lists&quot;</span><span class=p>,</span>
<span class=w>      </span><span class=nt>&quot;text&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Sometimes you want numbered lists: One Two Three Sometimes you want bullet points: Start a line with a star Profit!&quot;</span>
<span class=w>    </span><span class=p>}</span>
<span class=w>  </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div> </div> </div> </div> </details> <p>If we inspect the search index again, we can see how the situation improved:</p> <ol> <li> <p><strong>Content is included only once</strong>: the search index does not include the<br> content of the page twice, as only the sections of a page are part of the<br> search index. This leads to a significant reduction in size, fewer bytes to<br> transfer, and a smaller search index.</p> </li> <li> <p><strong>Some structure is preserved</strong>: each section of the search index includes<br> a small subset of HTML to provide the necessary structure to allow for more<br> sophisticated search previews. Revisiting our example from before, let's<br> look at an excerpt:</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=rich-search-previews-now_2 name=__tabbed_4 type=radio><input id=rich-search-previews-before_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=rich-search-previews-now_2>Now</label><label for=rich-search-previews-before_2>Before</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>… links, or even <span class=p>&lt;</span><span class=nt>code</span><span class=p>&gt;</span>code<span class=p>&lt;/</span><span class=nt>code</span><span class=p>&gt;</span>:<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nt>pre</span><span class=p>&gt;&lt;</span><span class=nt>code</span><span class=p>&gt;</span>if (isAwesome){ … }\n<span class=p>&lt;/</span><span class=nt>code</span><span class=p>&gt;&lt;/</span><span class=nt>pre</span><span class=p>&gt;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>… links , or even code : if (isAwesome) { … }
</code></pre></div> </div> </div> </div> <p>The punctuation issue is gone, as no additional whitespace is inserted, and<br> the preserved markup yields additional context to make scanning search<br> results more effective.</p> </li> </ol> <p>On to the next step in the process: <strong>tokenization</strong>.</p> <h3 id=tokenizer-lookahead>Tokenizer lookahead<a class=headerlink href=#tokenizer-lookahead title="Permanent link"></a></h3> <p>The <a href=https://github.com/olivernn/lunr.js/blob/aa5a878f62a6bba1e8e5b95714899e17e8150b38/lunr.js#L413-L456>default tokenizer</a> of <a href=https://lunrjs.com>lunr</a> uses a regular expression to split a given<br> string by matching each character against the <a href=../../plugins/search.md#config.separator><code>separator</code></a> as<br> defined in <code>mkdocs.yml</code>. This doesn't allow for more complex separators based<br> on lookahead or multiple characters.</p> <p>Fortunately, <strong>our new search implementation provides an advanced tokenizer</strong><br> that doesn't have these shortcomings and supports more complex regular<br> expressions. As a result, Material for MkDocs just changed its own separator<br> configuration to the following value:</p> <div class=highlight><pre><span></span><code>[\s\-,:!=\[\]()&quot;/]+|(?!\b)(?=[A-Z][a-z])|\.(?!\d)|&amp;[lg]t;
</code></pre></div> <p>While the first part up to the first <code>|</code> contains a list of single control<br> characters at which the string should be split, the following three sections<br> explain the remainder of the regular expression.<sup id=fnref:4><a class=footnote-ref href=#fn:4>4</a></sup></p> <h4 id=case-changes>Case changes<a class=headerlink href=#case-changes title="Permanent link"></a></h4> <p>Many programming languages use <code>PascalCase</code> or <code>camelCase</code> naming conventions.<br> When a user searches for the term <code>case</code>, it's quite natural to expect for<br> <code>PascalCase</code> and <code>camelCase</code> to show up. By adding the following match group to<br> the separator, this can now be achieved with ease:</p> <div class=highlight><pre><span></span><code>(?!\b)(?=[A-Z][a-z])
</code></pre></div> <p>This regular expression is a combination of a negative lookahead (<code>\b</code>, i.e.,<br> not a word boundary) and a positive lookahead (<code>[A-Z][a-z]</code>, i.e., an uppercase<br> character followed by a lowercase character), and has the following behavior:</p> <ul> <li><code>PascalCase</code> <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/></svg></span> <code>Pascal</code>, <code>Case</code></li> <li><code>camelCase</code> <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/></svg></span> <code>camel</code>, <code>Case</code></li> <li><code>UPPERCASE</code> <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.749.749 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/></svg></span> <code>UPPERCASE</code></li> </ul> <p>Searching for <a href="?q=searchHighlight"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.25 2a8.25 8.25 0 0 1 6.34 13.53l5.69 5.69a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-5.69-5.69A8.25 8.25 0 1 1 10.25 2ZM3.5 10.25a6.75 6.75 0 1 0 13.5 0 6.75 6.75 0 0 0-13.5 0Z"/></svg></span> searchHighlight</a><br> now brings up the section discussing the <code>search.highlight</code> feature flag, which<br> also demonstrates that this now even works properly for search queries.<sup id=fnref:5><a class=footnote-ref href=#fn:5>5</a></sup></p> <h4 id=version-numbers>Version numbers<a class=headerlink href=#version-numbers title="Permanent link"></a></h4> <p>Indexing version numbers is another problem that can be solved with a small<br> lookahead. Usually, <code>.</code> should be considered a separator to split words like<br> <code>search.highlight</code>. However, splitting version numbers at <code>.</code> will make them<br> undiscoverable. Thus, the following expression:</p> <div class=highlight><pre><span></span><code>\.(?!\d)
</code></pre></div> <p>This regular expression matches a <code>.</code> only if not immediately followed by a<br> digit <code>\d</code>, which leaves version numbers discoverable. Searching for<br> <a href="?q=7.2.6"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.25 2a8.25 8.25 0 0 1 6.34 13.53l5.69 5.69a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-5.69-5.69A8.25 8.25 0 1 1 10.25 2ZM3.5 10.25a6.75 6.75 0 1 0 13.5 0 6.75 6.75 0 0 0-13.5 0Z"/></svg></span> 7.2.6</a> brings up the <a href=../../changelog/index.md#7.2.6>7.2.6</a> release notes.</p> <h4 id=htmlxml-tags>HTML/XML tags<a class=headerlink href=#htmlxml-tags title="Permanent link"></a></h4> <p>If your documentation includes HTML/XML code examples, you may want to allow<br> users to find specific tag names. Unfortunately, the <code>&lt;</code> and <code>&gt;</code> control<br> characters are encoded in code blocks as <code>&amp;lt;</code> and <code>&amp;gt;</code>. Now, adding the<br> following expression to the separator allows for just that:</p> <div class=highlight><pre><span></span><code>&amp;[lg]t;
</code></pre></div> <hr> <p><em>We've only just begun to scratch the surface of the new possibilities<br> tokenizer lookahead brings. If you found other useful expressions, you're<br> invited to share them in the comment section.</em></p> <h3 id=accurate-highlighting>Accurate highlighting<a class=headerlink href=#accurate-highlighting title="Permanent link"></a></h3> <p>Highlighting is the last step in the process of search and involves the<br> highlighting of all search term occurrences in a given search result. For a<br> long time, highlighting was implemented through dynamically generated<br> <a href=https://github.com/squidfunk/mkdocs-material/blob/ec7ccd2b2d15dd033740f388912f7be7738feec2/src/assets/javascripts/integrations/search/highlighter/index.ts#L61-L91>regular expressions</a>.<sup id=fnref:6><a class=footnote-ref href=#fn:6>6</a></sup></p> <p>This approach has some problems with non-whitespace languages like Japanese or<br> Chinese<sup id=fnref:3><a class=footnote-ref href=#fn:3>3</a></sup> since it only works if the highlighted term is at a word boundary.<br> However, Asian languages are tokenized using a <a href=http://chasen.org/~taku/software/TinySegmenter/ >dedicated segmenter</a>, which<br> cannot be modeled with regular expressions.</p> <p>Now, as a direct result of the <a href=#tokenizer-lookahead>new tokenization approach</a>, <strong>our new search<br> implementation uses token positions for highlighting</strong>, making it exactly as<br> powerful as tokenization:</p> <ol> <li> <p><strong>Word boundaries</strong>: as the new highlighter uses token positions, word<br> boundaries are equal to token boundaries. This means that more complex cases<br> of tokenization (e.g., <a href=#case-changes>case changes</a>, <a href=#version-numbers>version numbers</a>, <a href=#htmlxml-tags>HTML/XML tags</a>),<br> are now all highlighted accurately.</p> </li> <li> <p><strong>Context-awareness</strong>: as the new search index preserves some of the<br> structural information of the original document, the content of a section<br> is now divided into separate content blocks – paragraphs, code blocks, and<br> lists.</p> <p>Now, only the content blocks that actually contain occurrences of one of<br> the search terms are considered for inclusion into the search preview. If a<br> term only occurs in a code block, it's the code block that gets rendered,<br> see, for example, the results of<br> <a href="?q=twitter"><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10.25 2a8.25 8.25 0 0 1 6.34 13.53l5.69 5.69a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215l-5.69-5.69A8.25 8.25 0 1 1 10.25 2ZM3.5 10.25a6.75 6.75 0 1 0 13.5 0 6.75 6.75 0 0 0-13.5 0Z"/></svg></span> twitter</a>.</p> </li> </ol> <h3 id=benchmarks>Benchmarks<a class=headerlink href=#benchmarks title="Permanent link"></a></h3> <p>We conducted two benchmarks – one with the documentation of Material for MkDocs<br> itself, and one with a very massive corpus of Markdown files with more than<br> 800,000 words – a size most documentation projects will likely never<br> reach:</p> <figure> <table> <thead> <tr> <th></th> <th style="text-align: right;">Before</th> <th style="text-align: right;">Now</th> <th style="text-align: right;">Relative</th> </tr> </thead> <tbody> <tr> <td><strong>Material for MkDocs</strong></td> <td style="text-align: right;"></td> <td style="text-align: right;"></td> <td style="text-align: right;"></td> </tr> <tr> <td>Index size</td> <td style="text-align: right;">573 kB</td> <td style="text-align: right;"><strong>335 kB</strong></td> <td style="text-align: right;"><strong>–42%</strong></td> </tr> <tr> <td>Index size (<code>gzip</code>)</td> <td style="text-align: right;">105 kB</td> <td style="text-align: right;"><strong>78 kB</strong></td> <td style="text-align: right;"><strong>–27%</strong></td> </tr> <tr> <td>Indexing time<sup id=fnref:7><a class=footnote-ref href=#fn:7>7</a></sup></td> <td style="text-align: right;">265 ms</td> <td style="text-align: right;"><strong>177 ms</strong></td> <td style="text-align: right;"><strong>–34%</strong></td> </tr> <tr> <td><strong>KJV Markdown<sup id=fnref:8><a class=footnote-ref href=#fn:8>8</a></sup></strong></td> <td style="text-align: right;"></td> <td style="text-align: right;"></td> <td style="text-align: right;"></td> </tr> <tr> <td>Index size</td> <td style="text-align: right;">8.2 MB</td> <td style="text-align: right;"><strong>4.4 MB</strong></td> <td style="text-align: right;"><strong>–47%</strong></td> </tr> <tr> <td>Index size (<code>gzip</code>)</td> <td style="text-align: right;">2.3 MB</td> <td style="text-align: right;"><strong>1.2 MB</strong></td> <td style="text-align: right;"><strong>–48%</strong></td> </tr> <tr> <td>Indexing time</td> <td style="text-align: right;">2,700 ms</td> <td style="text-align: right;"><strong>1,390 ms</strong></td> <td style="text-align: right;"><strong>–48%</strong></td> </tr> </tbody> </table> <figcaption> <p>Benchmark results</p> </figcaption> </figure> <p>The results show that indexing time, which is the time that it takes to set up<br> the search when the page is loaded, has dropped by up to 48%, which means <strong>the<br> new search is up to 95% faster</strong>. This is a significant improvement,<br> particularly relevant for large documentation projects.</p> <p>While 1,3s still may sound like a long time, using the new client-side search<br> together with <a href=../../setup/setting-up-navigation.md#instant-loading>instant loading</a> only creates the search index on the initial<br> page load. When navigating, the search index is preserved across pages, so the<br> cost does only have to be paid once.</p> <h3 id=user-interface>User interface<a class=headerlink href=#user-interface title="Permanent link"></a></h3> <p>Additionally, some small improvements have been made, most prominently the<br> <strong>more results on this page</strong> button, which now sticks to the top of the search<br> result list when open. This enables the user to jump out of the list more<br> quickly.</p> <h2 id=whats-next>What's next?<a class=headerlink href=#whats-next title="Permanent link"></a></h2> <p>Our new search implementation is a big improvement to Material for MkDocs. It<br> solves some long-standing issues which needed to be tackled for years. Yet,<br> it's only the start of a search experience that is going to get better and<br> better. Next up:</p> <ul> <li> <p><strong>Context-aware search summarization</strong>: currently, the first two matching<br> content blocks are rendered as a search preview. With the new tokenization<br> technique, we laid the groundwork for more sophisticated shortening and<br> summarization methods, which we're tackling next.</p> </li> <li> <p><strong>User interface improvements</strong>: as we now gained full control over the<br> search plugin, we can now add meaningful metadata to provide more context and<br> a better experience. We'll explore some of those paths in the future.</p> </li> </ul> <p>If you've made it this far, thank you for your time and interest in Material<br> for MkDocs! This is the first blog article that I decided to write after a<br> short [Twitter survey] made me to. You're invited to leave a comment<br> to share your experiences with the new search implementation.</p> <div class=footnote> <hr> <ol> <li id=fn:1> <p>Prior to , search was carried out in the main<br> thread which locked up the browser, rendering it unusable. This problem was<br> first reported in #904 and, after some back and forth, fixed and released in<br> .&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>At the time of writing, <a href=https://pmarsceill.github.io/just-the-docs/ >Just the Docs</a> and <a href=https://github.com/lelouch77/docusaurus-lunr-search>Docusaurus</a> use this method<br> for generating search previews. Note that the latter also integrates with<br> Algolia, which is a fully managed server-based solution.&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:3> <p>China and Japan are both within the top 5 countries of origin of users of<br> Material for MkDocs.&#160;<a class=footnote-backref href=#fnref:3 title="Jump back to footnote 3 in the text">&#8617;</a><a class=footnote-backref href=#fnref2:3 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:4> <p>As a fun fact: the <a href=../../plugins/search.md#config.separator><code>separator</code></a> <a href=https://www.mkdocs.org/user-guide/configuration/#separator>default value</a> of the search<br> plugin being <code>[\s\-]+</code> always has been kind of irritating, as it suggests<br> that multiple characters can be considered being a separator. However, the<br> <code>+</code> is completely irrelevant, as regular expression groups involving<br> multiple characters were never supported by<br> <a href=https://github.com/olivernn/lunr.js/blob/aa5a878f62a6bba1e8e5b95714899e17e8150b38/lunr.js#L413-L456>lunr's default tokenizer</a>.&#160;<a class=footnote-backref href=#fnref:4 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:5> <p>Previously, the search query was not correctly tokenized due to the way<br> <a href=https://lunrjs.com>lunr</a> treats wildcards, as it disables the pipeline for search terms that<br> contain wildcards. In order to provide a good typeahead experience,<br> Material for MkDocs adds wildcards to the end of each search term not<br> explicitly preceded with <code>+</code> or <code>-</code>, effectively disabling tokenization.&#160;<a class=footnote-backref href=#fnref:5 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> <li id=fn:6> <p>Using the separator as defined in <code>mkdocs.yml</code>, a regular expression was<br> constructed that was trying to mimic the tokenizer. As an example, the<br> search query <code>search highlight</code> was transformed into the rather cumbersome<br> regular expression <code>(^|&lt;separator&gt;)(search|highlight)</code>, which only matches<br> at word boundaries.&#160;<a class=footnote-backref href=#fnref:6 title="Jump back to footnote 6 in the text">&#8617;</a></p> </li> <li id=fn:7> <p>Smallest value of ten distinct runs.&#160;<a class=footnote-backref href=#fnref:7 title="Jump back to footnote 7 in the text">&#8617;</a></p> </li> <li id=fn:8> <p>We agnostically use <a href=https://github.com/arleym/kjv-markdown>KJV Markdown</a> as a tool for testing to learn how<br> Material for MkDocs behaves on large corpora, as it's a very large set of<br> Markdown files with over 800k words.&#160;<a class=footnote-backref href=#fnref:8 title="Jump back to footnote 8 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=footer.title> <a href=../26/excluding-content-from-search.html class="md-footer__link md-footer__link--next" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Excluding content from search </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> with emoji by <a href=https://github.com/twitter/twemoji target=_blank rel=noopener> Twemoji </a> </div> <div class=md-social> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "sitemap", "navigation.tabs", "navigation.top", "navigation.instant", "navigation.indexes", "toc.follow", "content.tabs.link", "search.share", "search.suggest", "content.code.copy", "content.code.annotations"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../assets/javascripts/bundle.471ce7a9.min.js></script> <script src=https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=../../../../assets/pymdownx-extras/extra-loader-iLQ-keay.js></script> </body> </html>